pipeline {
  agent any
  stages {
    stage('cleanup') {
      steps {
        sh 'docker system prune -a --volumes --force'
      }
    }
    stage('build image') {
      steps {
        sh 'docker build -t darinpope/jenkins-example-ghcr:8.5-204 .'
      }
    }
    stage('login to GHCR') {
      steps {
        script{
           withEnv([
                        "MY_ENV_VARIABLE=credentials",
                        "GITHUB_TOKEN=github_token"
                    ]) {
                        // The environment variables and credentials are available in this block
                        sh 'echo $MY_ENV_VARIABLE'
                        withCredentials([string(credentialsId: 'github_token', variable: 'GITHUB_TOKEN')]) {
                            sh 'echo $GITHUB_TOKEN' // Access the secret credential
                        }
                    }
           sh 'echo $GITHUB_TOKEN | docker login ghcr.io -u deepika0196 --password-stdin'
      }
    }
  }
} 
}
